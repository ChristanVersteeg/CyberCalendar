name: Daily Secret Publish

on:
  schedule:
    - cron: "0 0 * * *"  # runs at 00:00 UTC every day
  workflow_dispatch:      # allows manual trigger in GitHub Actions

jobs:
  publish-secret:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # 1) Retrieve the text array from secrets
      - name: Retrieve text array
        id: get_text_array
        run: |
          echo "array=${{ secrets.TEXT_ARRAY }}" >> $GITHUB_OUTPUT

      # 2) Parse it in some script, pick the dayâ€™s snippet, and create an output file
      - name: Pick daily snippet
        run: |
          # "array" is a JSON string; let's parse it in bash/Python
          echo "${{ steps.get_text_array.outputs.array }}" > array.json

          # Grab the current index from somewhere; either a second secret or a small "index file" in the repo:
          if [ -f current_index.txt ]; then
            currentIndex=$(cat current_index.txt)
          else
            currentIndex=0
          fi

          # Use Python just to parse JSON easily:
          dailySnippet=$(python -c "import json; arr = json.load(open('array.json')); print(arr[$currentIndex])")

          # Prepare an HTML or JSON snippet to publish
          echo "Today's text: $dailySnippet" > snippet.html

          # Next index
          nextIndex=$(( currentIndex + 1 ))

          # If we want to cycle, do something like:
          # nextIndex=$(( nextIndex % $(python -c "import json; print(len(json.load(open('array.json'))))") ))

          echo $nextIndex > current_index.txt

      # 3) Commit the updated snippet.html + current_index.txt to the repo
      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add snippet.html current_index.txt
          git commit -m "Update daily snippet"
          git push
